<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Data Processing Blueprints" href="blueprints-dataprocessing.html" /><link rel="prev" title="Blueprints" href="blueprints.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2024.01.29 -->
        <title>Database Blueprints - BluePrints 0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=ae89fe9e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">BluePrints 0.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo-optipack.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">BluePrints 0.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="blueprints.html">Blueprints</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Blueprints</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Database Blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints-dataprocessing.html">Data Processing Blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints-ml-training.html">ML Training Blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints-ml-serving.html">ML Serving Blueprints</a></li>
<li class="toctree-l2"><a class="reference internal" href="blueprints-ml-consuming.html">ML Consuming Blueprints</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../code-docs/code-documentation.html">Code Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Code Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../code-docs/data-processing-utils.html">Data Processing Utilities</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Data Processing Utilities</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../code-docs/data-processing-utils-data-cleaning.html">Data Cleaning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../code-docs/data-processing-utils-feature-engineering.html">Feature Engineering</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="database-blueprints">
<h1>Database Blueprints<a class="headerlink" href="#database-blueprints" title="Link to this heading">#</a></h1>
<p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
<section id="what-are-database-blueprints">
<h2>What are Database Blueprints?<a class="headerlink" href="#what-are-database-blueprints" title="Link to this heading">#</a></h2>
<p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
</section>
<section id="our-database-blueprints">
<h2>Our Database Blueprints<a class="headerlink" href="#our-database-blueprints" title="Link to this heading">#</a></h2>
<p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
</section>
<section id="mongodb-database-blueprint">
<h2>MongoDB Database Blueprint<a class="headerlink" href="#mongodb-database-blueprint" title="Link to this heading">#</a></h2>
<span class="index-entry">Database</span>
<span class="index-entry">MongoDB</span><p>lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="linenos">  2</span><span class="kn">import</span> <span class="nn">uuid</span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">fastiot.core</span> <span class="kn">import</span> <span class="n">FastIoTService</span><span class="p">,</span> <span class="n">reply</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">fastiot.db.mongodb_helper_fn</span> <span class="kn">import</span> <span class="n">get_mongodb_client_from_env</span>
<span class="linenos">  6</span><span class="kn">from</span> <span class="nn">fastiot.msg.thing</span> <span class="kn">import</span> <span class="n">Thing</span>
<span class="linenos">  7</span><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">UpdateOne</span>
<span class="linenos">  8</span><span class="kn">from</span> <span class="nn">pymongo.results</span> <span class="kn">import</span> <span class="n">InsertManyResult</span><span class="p">,</span> <span class="n">BulkWriteResult</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span><span class="kn">from</span> <span class="nn">blueprint_dev_v2.ml_lifecycle_utils.ml_lifecycle_broker_facade</span> <span class="kn">import</span> <span class="n">ok_response_thing</span><span class="p">,</span> <span class="n">error_response_thing</span>
<span class="linenos"> 11</span><span class="kn">from</span> <span class="nn">blueprint_dev_v2.ml_lifecycle_utils.ml_lifecycle_subjects_name</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 12</span>    <span class="n">DB_SAVE_MANY_RAW_DATAPOINTS_SUBJECT</span><span class="p">,</span>
<span class="linenos"> 13</span>    <span class="n">DB_GET_ALL_RAW_DATA_SUBJECT</span><span class="p">,</span>
<span class="linenos"> 14</span>    <span class="n">DB_UPSERT_MANY_PROCESSED_DATAPOINTS_SUBJECT</span><span class="p">,</span>
<span class="linenos"> 15</span>    <span class="n">DB_GET_PROCESSED_DATA_COUNT_SUBJECT</span><span class="p">,</span>
<span class="linenos"> 16</span>    <span class="n">DB_GET_PROCESSED_DATA_PAGE_SUBJECT</span>
<span class="linenos"> 17</span><span class="p">)</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="k">class</span> <span class="nc">DatabaseMongoService</span><span class="p">(</span><span class="n">FastIoTService</span><span class="p">):</span>
<span class="linenos"> 21</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 22</span><span class="sd">        This is the DatabaseMongoService class.</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="sd">        This service is responsible for storing and retrieving data from the database.</span>
<span class="linenos"> 25</span><span class="sd">        It implements the CRUD operations (create, read, update, delete) and provides these functionalities to other</span>
<span class="linenos"> 26</span><span class="sd">        services via the broker.</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span><span class="sd">        Attributes</span>
<span class="linenos"> 29</span><span class="sd">        ----------</span>
<span class="linenos"> 30</span><span class="sd">        _DB_NAME : str</span>
<span class="linenos"> 31</span><span class="sd">            The name of the database.</span>
<span class="linenos"> 32</span><span class="sd">        _MONGO_DB : str</span>
<span class="linenos"> 33</span><span class="sd">            The name of the MongoDB database.</span>
<span class="linenos"> 34</span><span class="sd">        _MONGO_RAW_DATA_COLLECTION : str</span>
<span class="linenos"> 35</span><span class="sd">            The name of the MongoDB collection for raw data.</span>
<span class="linenos"> 36</span><span class="sd">        _MONGO_PROCESSED_DATA_COLLECTION : str</span>
<span class="linenos"> 37</span><span class="sd">            The name of the MongoDB collection for processed data.</span>
<span class="linenos"> 38</span><span class="sd">        _mongodb_client : MongoClient</span>
<span class="linenos"> 39</span><span class="sd">            The MongoDB client.</span>
<span class="linenos"> 40</span><span class="sd">        _db : Database</span>
<span class="linenos"> 41</span><span class="sd">            The MongoDB database.</span>
<span class="linenos"> 42</span><span class="sd">        _raw_data_collection : Collection</span>
<span class="linenos"> 43</span><span class="sd">            The MongoDB collection for raw data.</span>
<span class="linenos"> 44</span><span class="sd">        _processed_data_collection : Collection</span>
<span class="linenos"> 45</span><span class="sd">            The MongoDB collection for processed data.</span>
<span class="linenos"> 46</span>
<span class="linenos"> 47</span><span class="sd">        Methods</span>
<span class="linenos"> 48</span><span class="sd">        -------</span>
<span class="linenos"> 49</span><span class="sd">        __init__(**kwargs)</span>
<span class="linenos"> 50</span><span class="sd">            Constructs all the necessary attributes for the DatabaseMongoService object.</span>
<span class="linenos"> 51</span><span class="sd">        db_save_many_raw_datapoints(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 52</span><span class="sd">            Saves many raw data points to the database.</span>
<span class="linenos"> 53</span><span class="sd">        db_save_upsert_processed_datapoints(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 54</span><span class="sd">            Upserts many processed data points to the database.</span>
<span class="linenos"> 55</span><span class="sd">        get_all_raw_data(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 56</span><span class="sd">            Gets all raw data from the database.</span>
<span class="linenos"> 57</span><span class="sd">        get_processed_data_count(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 58</span><span class="sd">            Gets the count of processed data points in the database.</span>
<span class="linenos"> 59</span><span class="sd">        get_processed_data_page(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 60</span><span class="sd">            Gets a page of processed data points from the database.</span>
<span class="linenos"> 61</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>    <span class="n">_DB_NAME</span> <span class="o">=</span> <span class="s2">&quot;mongodb&quot;</span>
<span class="linenos"> 64</span>    <span class="n">_MONGO_DB</span> <span class="o">=</span> <span class="s2">&quot;KIOptiPackDb&quot;</span>
<span class="linenos"> 65</span>    <span class="n">_MONGO_RAW_DATA_COLLECTION</span> <span class="o">=</span> <span class="s2">&quot;KIOptiPackRaw&quot;</span>
<span class="linenos"> 66</span>    <span class="n">_MONGO_PROCESSED_DATA_COLLECTION</span> <span class="o">=</span> <span class="s2">&quot;KIOptiPackProcessed&quot;</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos"> 69</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 70</span><span class="sd">        Constructs all the necessary attributes for the DatabaseMongoService object.</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span><span class="sd">        Parameters</span>
<span class="linenos"> 73</span><span class="sd">        ------------</span>
<span class="linenos"> 74</span><span class="sd">        kwargs : dict</span>
<span class="linenos"> 75</span><span class="sd">             keyword arguments that are passed to the FastIoTService constructor.</span>
<span class="linenos"> 76</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 77</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos"> 78</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mongodb_client</span> <span class="o">=</span> <span class="n">get_mongodb_client_from_env</span><span class="p">()</span>
<span class="linenos"> 79</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mongodb_client</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MONGO_DB</span><span class="p">]</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MONGO_RAW_DATA_COLLECTION</span><span class="p">]</span>
<span class="linenos"> 82</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_MONGO_PROCESSED_DATA_COLLECTION</span><span class="p">]</span>
<span class="linenos"> 83</span>        <span class="c1"># self._trained_model_collection = self._db[self._MONGO_TRAINED_MODEL_COLLECTION]</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_SAVE_MANY_RAW_DATAPOINTS_SUBJECT</span><span class="p">)</span>
<span class="linenos"> 86</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">db_save_many_raw_datapoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos"> 87</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 88</span><span class="sd">        Saves many raw data points to the database.</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span><span class="sd">        Parameters</span>
<span class="linenos"> 91</span><span class="sd">        ----------</span>
<span class="linenos"> 92</span><span class="sd">        _</span>
<span class="linenos"> 93</span><span class="sd">            The topic of the message. This is not used in this method.</span>
<span class="linenos"> 94</span><span class="sd">        msg</span>
<span class="linenos"> 95</span><span class="sd">            The message that contains the raw data points to be saved to the database.</span>
<span class="linenos"> 96</span><span class="sd">        Returns</span>
<span class="linenos"> 97</span><span class="sd">        -------</span>
<span class="linenos"> 98</span><span class="sd">        Thing</span>
<span class="linenos"> 99</span><span class="sd">            A Thing object that contains the result of the operation. This is either an acknowledgement or an error.</span>
<span class="linenos">100</span><span class="sd">            Acknowledgements contain the number of raw data points that were saved to the database.</span>
<span class="linenos">101</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">102</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos">103</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Payload (the &#39;value&#39; field of the msg Thing) must be of type list, &quot;</span>
<span class="linenos">104</span>                               <span class="sa">f</span><span class="s2">&quot;but received: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">105</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Payload must be a list of raw data points&quot;</span><span class="p">)</span>
<span class="linenos">106</span>
<span class="linenos">107</span>        <span class="n">data_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">108</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span><span class="si">}</span><span class="s2"> raw data points to be inserted into mongodb&quot;</span><span class="p">)</span>
<span class="linenos">109</span>
<span class="linenos">110</span>        <span class="c1"># add uuids to data points</span>
<span class="linenos">111</span>        <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">data_points</span><span class="p">:</span>
<span class="linenos">112</span>            <span class="n">data_point</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="linenos">113</span>
<span class="linenos">114</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insering data points into mongodb&quot;</span><span class="p">)</span>
<span class="linenos">115</span>        <span class="n">res</span><span class="p">:</span> <span class="n">InsertManyResult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data_collection</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span>
<span class="linenos">116</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DB transaction result: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">acknowledged</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">117</span>
<span class="linenos">118</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">inserted_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> raw data points into mongodb&quot;</span><span class="p">)</span>
<span class="linenos">119</span>
<span class="linenos">120</span>        <span class="c1"># feel free to include whatever information you want to return here.</span>
<span class="linenos">121</span>        <span class="n">db_specific_info</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">122</span>            <span class="s2">&quot;acknowledged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="linenos">123</span>            <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;MongoDB&quot;</span><span class="p">,</span>
<span class="linenos">124</span>        <span class="p">}</span>
<span class="linenos">125</span>
<span class="linenos">126</span>        <span class="c1"># in principle one does not need to return information here.</span>
<span class="linenos">127</span>        <span class="c1"># However, some infos are return here, so that the requesting service can log the information.</span>
<span class="linenos">128</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">db_specific_info</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">129</span>
<span class="linenos">130</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_UPSERT_MANY_PROCESSED_DATAPOINTS_SUBJECT</span><span class="p">)</span>
<span class="linenos">131</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">db_save_upsert_processed_datapoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">132</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">133</span><span class="sd">        Upserts many processed data points to the database.</span>
<span class="linenos">134</span>
<span class="linenos">135</span><span class="sd">        Parameters</span>
<span class="linenos">136</span><span class="sd">        ----------</span>
<span class="linenos">137</span><span class="sd">        _</span>
<span class="linenos">138</span><span class="sd">            The topic of the message. This is not used in this method.</span>
<span class="linenos">139</span><span class="sd">        msg</span>
<span class="linenos">140</span><span class="sd">            The message that contains the processed data points to be upserted to the database.</span>
<span class="linenos">141</span>
<span class="linenos">142</span><span class="sd">        Returns</span>
<span class="linenos">143</span><span class="sd">        -------</span>
<span class="linenos">144</span><span class="sd">        Thing</span>
<span class="linenos">145</span><span class="sd">            A Thing object that contains the result of the operation. This is either an acknowledgement or an error.</span>
<span class="linenos">146</span><span class="sd">            Acknowledgements contain the number of processed data points that were upserted to the database.</span>
<span class="linenos">147</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">148</span>
<span class="linenos">149</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos">150</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Payload (the &#39;value&#39; field of the msg Thing) must be of type list, &quot;</span>
<span class="linenos">151</span>                               <span class="sa">f</span><span class="s2">&quot;but received: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">152</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Payload must be a list of processed data points&quot;</span><span class="p">)</span>
<span class="linenos">153</span>
<span class="linenos">154</span>        <span class="n">data_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">155</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span><span class="si">}</span><span class="s2"> processed data points to be inserted into mongodb&quot;</span><span class="p">)</span>
<span class="linenos">156</span>
<span class="linenos">157</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Upserting data points into mongodb using bulk wirte&quot;</span><span class="p">)</span>
<span class="linenos">158</span>        <span class="c1"># Prepare a list of UpdateOne operations</span>
<span class="linenos">159</span>        <span class="n">operations</span> <span class="o">=</span> <span class="p">[</span>
<span class="linenos">160</span>            <span class="n">UpdateOne</span><span class="p">(</span>
<span class="linenos">161</span>                <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">data_point</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]},</span>  <span class="c1"># filter</span>
<span class="linenos">162</span>                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">data_point</span><span class="p">},</span>  <span class="c1"># update</span>
<span class="linenos">163</span>                <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># upsert</span>
<span class="linenos">164</span>            <span class="p">)</span>
<span class="linenos">165</span>            <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">data_points</span>
<span class="linenos">166</span>        <span class="p">]</span>
<span class="linenos">167</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">168</span>            <span class="n">res</span><span class="p">:</span> <span class="n">BulkWriteResult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data_collection</span><span class="o">.</span><span class="n">bulk_write</span><span class="p">(</span><span class="n">operations</span><span class="p">)</span>
<span class="linenos">169</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">170</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while upserting processed data points into mongodb: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">171</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">172</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DB transaction result: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">acknowledged</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">173</span>
<span class="linenos">174</span>        <span class="c1"># feel free to include whatever information you want to return here.</span>
<span class="linenos">175</span>        <span class="n">db_specific_info</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">176</span>            <span class="s2">&quot;acknowledged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="linenos">177</span>            <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;MongoDB&quot;</span><span class="p">,</span>
<span class="linenos">178</span>        <span class="p">}</span>
<span class="linenos">179</span>
<span class="linenos">180</span>        <span class="c1"># in principle one does not need to return information here.</span>
<span class="linenos">181</span>        <span class="c1"># However, some infos are return here, so that the requesting service can log the information.</span>
<span class="linenos">182</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">db_specific_info</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">183</span>
<span class="linenos">184</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_GET_ALL_RAW_DATA_SUBJECT</span><span class="p">)</span>
<span class="linenos">185</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_all_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">__</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">186</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">187</span><span class="sd">        Gets all raw data from the database.</span>
<span class="linenos">188</span><span class="sd">        Parameters</span>
<span class="linenos">189</span><span class="sd">        ----------</span>
<span class="linenos">190</span><span class="sd">        _</span>
<span class="linenos">191</span><span class="sd">            The topic of the message. This is not used in this method.</span>
<span class="linenos">192</span><span class="sd">        __</span>
<span class="linenos">193</span><span class="sd">            The message that contains the request to get all raw data from the database.</span>
<span class="linenos">194</span>
<span class="linenos">195</span><span class="sd">        Returns</span>
<span class="linenos">196</span><span class="sd">        -------</span>
<span class="linenos">197</span><span class="sd">        Thing</span>
<span class="linenos">198</span><span class="sd">            A Thing object that contains the result of the operation. This is either an acknowledgement or an error.</span>
<span class="linenos">199</span><span class="sd">            Acknowledgements contain all the raw data from the database.</span>
<span class="linenos">200</span>
<span class="linenos">201</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">202</span>
<span class="linenos">203</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received request to get all raw data from mongodb&quot;</span><span class="p">)</span>
<span class="linenos">204</span>
<span class="linenos">205</span>        <span class="n">filter_kwargs</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># empty dict means no filter</span>
<span class="linenos">206</span>        <span class="n">raw_data_entries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data_collection</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
<span class="linenos">207</span>        <span class="n">raw_data_entries</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data_entries</span><span class="p">]</span>
<span class="linenos">208</span>
<span class="linenos">209</span>        <span class="c1"># the native mongo ID is not serializable to json</span>
<span class="linenos">210</span>        <span class="c1"># so we convert it to a string</span>
<span class="linenos">211</span>        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data_entries</span><span class="p">:</span>
<span class="linenos">212</span>            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">])</span>
<span class="linenos">213</span>
<span class="linenos">214</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">raw_data_entries</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">215</span>
<span class="linenos">216</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_GET_PROCESSED_DATA_COUNT_SUBJECT</span><span class="p">)</span>
<span class="linenos">217</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_processed_data_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">__</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">218</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">219</span><span class="sd">        Gets the count of processed data points in the database.</span>
<span class="linenos">220</span><span class="sd">        Parameters</span>
<span class="linenos">221</span><span class="sd">        ----------</span>
<span class="linenos">222</span><span class="sd">        _</span>
<span class="linenos">223</span><span class="sd">            The topic of the message. This is not used in this method.</span>
<span class="linenos">224</span><span class="sd">        __</span>
<span class="linenos">225</span><span class="sd">            The message that contains the request to get the count of processed data points in the database.</span>
<span class="linenos">226</span>
<span class="linenos">227</span><span class="sd">        Returns</span>
<span class="linenos">228</span><span class="sd">        -------</span>
<span class="linenos">229</span><span class="sd">        Thing</span>
<span class="linenos">230</span><span class="sd">            A Thing object that contains the result of the operation. This is either an acknowledgement or an error.</span>
<span class="linenos">231</span><span class="sd">            Acknowledgements contain the count of processed data points in the database.</span>
<span class="linenos">232</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">233</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Received request to get the number of processed data points from mongodb&quot;</span><span class="p">)</span>
<span class="linenos">234</span>
<span class="linenos">235</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">236</span>            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data_collection</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({})</span>
<span class="linenos">237</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">238</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while counting processed data points in mongodb: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">239</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">240</span>
<span class="linenos">241</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">242</span>
<span class="linenos">243</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_GET_PROCESSED_DATA_PAGE_SUBJECT</span><span class="p">)</span>
<span class="linenos">244</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_processed_data_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">245</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">246</span><span class="sd">        Gets a page of processed data points from the database.</span>
<span class="linenos">247</span>
<span class="linenos">248</span><span class="sd">        Parameters</span>
<span class="linenos">249</span><span class="sd">        ----------</span>
<span class="linenos">250</span><span class="sd">        _</span>
<span class="linenos">251</span><span class="sd">        msg</span>
<span class="linenos">252</span><span class="sd">            The message that contains the request to get a page of processed data points from the database.</span>
<span class="linenos">253</span>
<span class="linenos">254</span><span class="sd">        Returns</span>
<span class="linenos">255</span><span class="sd">        -------</span>
<span class="linenos">256</span><span class="sd">        Thing</span>
<span class="linenos">257</span><span class="sd">            A Thing object that contains the result of the operation. This is either an acknowledgement or an error.</span>
<span class="linenos">258</span><span class="sd">            Acknowledgements contain a page of processed data points from the database.</span>
<span class="linenos">259</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">260</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received request to get a page of processed data points from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">261</span>        <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">262</span>            <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="linenos">263</span>            <span class="s2">&quot;page_size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="linenos">264</span>        <span class="p">}</span>
<span class="linenos">265</span>
<span class="linenos">266</span>        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">267</span>
<span class="linenos">268</span>        <span class="c1"># warning if unexpected parameters are present</span>
<span class="linenos">269</span>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="linenos">270</span>            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="linenos">271</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected parameter &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; in request. Ignoring it.&quot;</span><span class="p">)</span>
<span class="linenos">272</span>
<span class="linenos">273</span>        <span class="c1"># merge default and user parameters</span>
<span class="linenos">274</span>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">default_params</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">}</span>
<span class="linenos">275</span>
<span class="linenos">276</span>        <span class="c1"># check &#39;page&#39; and &#39;page_size&#39; are in the params dict</span>
<span class="linenos">277</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">278</span>            <span class="k">if</span> <span class="s2">&quot;page&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s2">&quot;page_size&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
<span class="linenos">279</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;params must contain &#39;page&#39; and &#39;page_size&#39;&quot;</span><span class="p">)</span>
<span class="linenos">280</span>            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">281</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page must be &gt;= 0&quot;</span><span class="p">)</span>
<span class="linenos">282</span>            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">283</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page_size must be &gt;= 0&quot;</span><span class="p">)</span>
<span class="linenos">284</span>
<span class="linenos">285</span>            <span class="n">page_documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processed_data_collection</span><span class="o">.</span><span class="n">find</span><span class="p">()</span> \
<span class="linenos">286</span>                <span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;page&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">])</span> \
<span class="linenos">287</span>                <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">])</span>
<span class="linenos">288</span>            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">page_documents</span><span class="p">]</span>
<span class="linenos">289</span>            <span class="c1"># drop the native mongo ID</span>
<span class="linenos">290</span>            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
<span class="linenos">291</span>                <span class="n">doc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="linenos">292</span>
<span class="linenos">293</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">294</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while counting processed data points in mongodb: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">295</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">296</span>
<span class="linenos">297</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">298</span>
<span class="linenos">299</span>
<span class="linenos">300</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">301</span>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="linenos">302</span>    <span class="n">DatabaseMongoService</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="mariadb-database-blueprint">
<h2>MariaDB Database Blueprint<a class="headerlink" href="#mariadb-database-blueprint" title="Link to this heading">#</a></h2>
<span class="index-entry">Database</span>
<span class="index-entry">MariaDB</span><p>lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="linenos">  2</span><span class="kn">import</span> <span class="nn">uuid</span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">blueprint_dev_v2.ml_lifecycle_utils.ml_lifecycle_broker_facade</span> <span class="kn">import</span> <span class="n">ok_response_thing</span><span class="p">,</span> <span class="n">error_response_thing</span>
<span class="linenos">  5</span><span class="kn">from</span> <span class="nn">blueprint_dev_v2.ml_lifecycle_utils.ml_lifecycle_subjects_name</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos">  6</span>    <span class="n">DB_SAVE_MANY_RAW_DATAPOINTS_SUBJECT</span><span class="p">,</span>
<span class="linenos">  7</span>    <span class="n">DB_GET_ALL_RAW_DATA_SUBJECT</span><span class="p">,</span>
<span class="linenos">  8</span>    <span class="n">DB_UPSERT_MANY_PROCESSED_DATAPOINTS_SUBJECT</span><span class="p">,</span>
<span class="linenos">  9</span>    <span class="n">DB_GET_PROCESSED_DATA_COUNT_SUBJECT</span><span class="p">,</span> <span class="n">DB_GET_PROCESSED_DATA_PAGE_SUBJECT</span>
<span class="linenos"> 10</span><span class="p">)</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="kn">from</span> <span class="nn">fastiot.core</span> <span class="kn">import</span> <span class="n">FastIoTService</span><span class="p">,</span> <span class="n">reply</span>
<span class="linenos"> 13</span><span class="kn">from</span> <span class="nn">fastiot.db.mariadb_helper_fn</span> <span class="kn">import</span> <span class="n">get_mariadb_client_from_env</span>
<span class="linenos"> 14</span><span class="kn">from</span> <span class="nn">fastiot.msg.thing</span> <span class="kn">import</span> <span class="n">Thing</span>
<span class="linenos"> 15</span>
<span class="linenos"> 16</span><span class="k">class</span> <span class="nc">DatabaseMariaService</span><span class="p">(</span><span class="n">FastIoTService</span><span class="p">):</span>
<span class="linenos"> 17</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 18</span><span class="sd">    This service is responsible for handling the database operations for the MariaDB database.</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="sd">    The service listens to the following subjects:</span>
<span class="linenos"> 21</span><span class="sd">    - `DB_SAVE_MANY_RAW_DATAPOINTS_SUBJECT`: to save many raw data points</span>
<span class="linenos"> 22</span><span class="sd">    - `DB_GET_ALL_RAW_DATA_SUBJECT`: to get all raw data</span>
<span class="linenos"> 23</span><span class="sd">    - `DB_UPSERT_MANY_PROCESSED_DATAPOINTS_SUBJECT`: to save or update many processed data points</span>
<span class="linenos"> 24</span><span class="sd">    - `DB_GET_PROCESSED_DATA_COUNT_SUBJECT`: to get the number of processed data points</span>
<span class="linenos"> 25</span><span class="sd">    - `DB_GET_PROCESSED_DATA_PAGE_SUBJECT`: to get a page of processed data points</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="sd">    The service uses the `mariadb_helper_fn.get_mariadb_client_from_env` function to get a MariaDB connection.</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span><span class="sd">    Attributes</span>
<span class="linenos"> 30</span><span class="sd">    ----------</span>
<span class="linenos"> 31</span><span class="sd">    _DB_NAME : str</span>
<span class="linenos"> 32</span><span class="sd">        The name of the database. This is used for logging purposes.</span>
<span class="linenos"> 33</span><span class="sd">    _mariadb_connection : mariadb.connection</span>
<span class="linenos"> 34</span><span class="sd">        The connection to the MariaDB database.</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="sd">    Methods</span>
<span class="linenos"> 37</span><span class="sd">    -------</span>
<span class="linenos"> 38</span><span class="sd">    _stop()</span>
<span class="linenos"> 39</span><span class="sd">        Stops the service.</span>
<span class="linenos"> 40</span><span class="sd">    setup_schemas_if_not_exists()</span>
<span class="linenos"> 41</span><span class="sd">        Creates the database schema and tables if they do not exist.</span>
<span class="linenos"> 42</span><span class="sd">    _start()</span>
<span class="linenos"> 43</span><span class="sd">        Starts the service.</span>
<span class="linenos"> 44</span><span class="sd">    db_save_many_raw_datapoints(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 45</span><span class="sd">        Saves many raw data points to the database.</span>
<span class="linenos"> 46</span><span class="sd">    get_all_raw_data(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 47</span><span class="sd">        Gets all raw data from the database.</span>
<span class="linenos"> 48</span><span class="sd">    db_save_upsert_processed_datapoints(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 49</span><span class="sd">        Saves or updates many processed data points in the database.</span>
<span class="linenos"> 50</span><span class="sd">    get_processed_data_count(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 51</span><span class="sd">        Gets the number of processed data points from the database.</span>
<span class="linenos"> 52</span><span class="sd">    get_processed_data_page(topic: str, msg: Thing) -&gt; Thing</span>
<span class="linenos"> 53</span><span class="sd">        Gets a page of processed data points from the database.</span>
<span class="linenos"> 54</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span>    <span class="n">_DB_NAME</span> <span class="o">=</span> <span class="s2">&quot;MariaDB&quot;</span>
<span class="linenos"> 57</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="linenos"> 58</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 59</span><span class="sd">        Parameters</span>
<span class="linenos"> 60</span><span class="sd">        ----------</span>
<span class="linenos"> 61</span><span class="sd">        kwargs</span>
<span class="linenos"> 62</span><span class="sd">            Additional keyword arguments to pass to the FastIoTService constructor.</span>
<span class="linenos"> 63</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 64</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="linenos"> 65</span>        <span class="c1"># NOTE: create the database/schema and table in the mariadb database before running this service</span>
<span class="linenos"> 66</span>        <span class="c1">#       you can use the following SQL statement to create the database and table:</span>
<span class="linenos"> 67</span>        <span class="c1">#</span>
<span class="linenos"> 68</span>        <span class="c1">#       CREATE DATABASE &lt;database_name&gt;;</span>
<span class="linenos"> 69</span>        <span class="c1">#</span>
<span class="linenos"> 70</span>        <span class="c1">#       replace &lt;database_name&gt; with the name of the database you want to create.</span>
<span class="linenos"> 71</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span> <span class="o">=</span> <span class="n">get_mariadb_client_from_env</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="s2">&quot;TestDB&quot;</span><span class="p">)</span>
<span class="linenos"> 72</span>
<span class="linenos"> 73</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 74</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 75</span><span class="sd">        Stops the service.</span>
<span class="linenos"> 76</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 77</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">-Service stopped&quot;</span><span class="p">)</span>
<span class="linenos"> 78</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>    <span class="k">def</span> <span class="nf">setup_schemas_if_not_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 81</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 82</span><span class="sd">        Creates the database schema and tables if they do not exist.</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span><span class="sd">        Returns</span>
<span class="linenos"> 85</span><span class="sd">        -------</span>
<span class="linenos"> 86</span><span class="sd">        None</span>
<span class="linenos"> 87</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 88</span>        <span class="c1"># create table if not exists. table-name: KIOptiPackRaw</span>
<span class="linenos"> 89</span>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos"> 90</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 91</span>            <span class="c1"># create table if not exists. table-name: KIOptiPackRaw</span>
<span class="linenos"> 92</span>            <span class="c1"># NOTE: replace the table name with your own table name</span>
<span class="linenos"> 93</span>            <span class="n">_</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS KIOptiPackRaw(&quot;</span>
<span class="linenos"> 94</span>                                              <span class="s2">&quot;id UUID PRIMARY KEY,&quot;</span>
<span class="linenos"> 95</span>                                              <span class="s2">&quot;material_id VARCHAR(36),&quot;</span>
<span class="linenos"> 96</span>                                              <span class="s2">&quot;datum VARCHAR(36),&quot;</span>
<span class="linenos"> 97</span>                                              <span class="s2">&quot;laborant VARCHAR(16),&quot;</span>
<span class="linenos"> 98</span>                                              <span class="s2">&quot;rohwert_1_labormessung FLOAT(12),&quot;</span>
<span class="linenos"> 99</span>                                              <span class="s2">&quot;rohwert_2_labormessung FLOAT(12),&quot;</span>
<span class="linenos">100</span>                                              <span class="s2">&quot;rohwert_3_labormessung FLOAT(12),&quot;</span>
<span class="linenos">101</span>                                              <span class="s2">&quot;aufbereiteter_wert FLOAT(12));&quot;</span>
<span class="linenos">102</span>                                              <span class="p">)</span>
<span class="linenos">103</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">-Table &#39;KIOptiPackRaw&#39; created successfully&quot;</span><span class="p">)</span>
<span class="linenos">104</span>
<span class="linenos">105</span>
<span class="linenos">106</span>            <span class="n">_</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS KIOptiPackProcessed(&quot;</span>
<span class="linenos">107</span>                                    <span class="s2">&quot;id UUID PRIMARY KEY,&quot;</span>
<span class="linenos">108</span>                                    <span class="s2">&quot;aufbereiteter_wert FLOAT(12),&quot;</span>
<span class="linenos">109</span>                                    <span class="s2">&quot;laborant_AN FLOAT(12),&quot;</span>
<span class="linenos">110</span>                                    <span class="s2">&quot;laborant_HANS FLOAT(12),&quot;</span>
<span class="linenos">111</span>                                    <span class="s2">&quot;laborant_SO FLOAT(12),&quot;</span>
<span class="linenos">112</span>                                    <span class="s2">&quot;laborant_TK FLOAT(12),&quot;</span>
<span class="linenos">113</span>                                    <span class="s2">&quot;material_id_00000000 FLOAT(12),&quot;</span>
<span class="linenos">114</span>                                    <span class="s2">&quot;material_id_11111111 FLOAT(12),&quot;</span>
<span class="linenos">115</span>                                    <span class="s2">&quot;material_id_22222222 FLOAT(12),&quot;</span>
<span class="linenos">116</span>                                    <span class="s2">&quot;material_id_33333333 FLOAT(12),&quot;</span>
<span class="linenos">117</span>                                    <span class="s2">&quot;rohwert_1_high FLOAT(12),&quot;</span>
<span class="linenos">118</span>                                    <span class="s2">&quot;rohwert_1_low FLOAT(12),&quot;</span>
<span class="linenos">119</span>                                    <span class="s2">&quot;rohwert_1_medium FLOAT(12),&quot;</span>
<span class="linenos">120</span>                                    <span class="s2">&quot;rohwert_1_very_high FLOAT(12),&quot;</span>
<span class="linenos">121</span>                                    <span class="s2">&quot;rohwert_1_very_low FLOAT(12),&quot;</span>
<span class="linenos">122</span>                                    <span class="s2">&quot;rohwert_2_labormessung FLOAT(12),&quot;</span>
<span class="linenos">123</span>                                    <span class="s2">&quot;rohwert_3_labormessung FLOAT(12));&quot;</span>
<span class="linenos">124</span>                                 <span class="p">)</span>
<span class="linenos">125</span>
<span class="linenos">126</span>            <span class="c1"># material_id_00000000</span>
<span class="linenos">127</span>            <span class="c1"># material_id_00000000-0000-0000-0000-000000000000</span>
<span class="linenos">128</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">-Table &#39;KIOptiPackProcessed&#39; created successfully&quot;</span><span class="p">)</span>
<span class="linenos">129</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">130</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while creating </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">-Table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">131</span>            <span class="k">raise</span> <span class="n">e</span>
<span class="linenos">132</span>        <span class="k">finally</span><span class="p">:</span>
<span class="linenos">133</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">134</span>
<span class="linenos">135</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">136</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">137</span><span class="sd">        Starts the service.</span>
<span class="linenos">138</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">139</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">-Service started&quot;</span><span class="p">)</span>
<span class="linenos">140</span>        <span class="bp">self</span><span class="o">.</span><span class="n">setup_schemas_if_not_exists</span><span class="p">()</span>
<span class="linenos">141</span>
<span class="linenos">142</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_SAVE_MANY_RAW_DATAPOINTS_SUBJECT</span><span class="p">)</span>
<span class="linenos">143</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">db_save_many_raw_datapoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">144</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">145</span><span class="sd">        Saves many raw data points to the database.</span>
<span class="linenos">146</span>
<span class="linenos">147</span><span class="sd">        Parameters</span>
<span class="linenos">148</span><span class="sd">        ----------</span>
<span class="linenos">149</span><span class="sd">        _</span>
<span class="linenos">150</span><span class="sd">            The topic of the message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">151</span><span class="sd">        msg</span>
<span class="linenos">152</span><span class="sd">            The message containing the raw data points to save.</span>
<span class="linenos">153</span>
<span class="linenos">154</span><span class="sd">        Returns</span>
<span class="linenos">155</span><span class="sd">        -------</span>
<span class="linenos">156</span><span class="sd">        Thing</span>
<span class="linenos">157</span><span class="sd">            A Thing containing the result of the operation. If the operation was successful, the Thing will contain</span>
<span class="linenos">158</span><span class="sd">            the number of rows inserted into the database. If the operation was not successful, the Thing will contain</span>
<span class="linenos">159</span><span class="sd">            an error message.</span>
<span class="linenos">160</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">161</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos">162</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Payload (the &#39;value&#39; field of the msg Thing) must be of type list, &quot;</span>
<span class="linenos">163</span>                      <span class="sa">f</span><span class="s2">&quot;but received: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">164</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Payload must be a list of raw data points&quot;</span><span class="p">)</span>
<span class="linenos">165</span>
<span class="linenos">166</span>        <span class="n">data_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">167</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span><span class="si">}</span><span class="s2"> raw data points to be inserted into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">168</span>
<span class="linenos">169</span>        <span class="c1"># create uuids for each data point</span>
<span class="linenos">170</span>        <span class="k">for</span> <span class="n">data_point</span> <span class="ow">in</span> <span class="n">data_points</span><span class="p">:</span>
<span class="linenos">171</span>            <span class="n">data_point</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="linenos">172</span>
<span class="linenos">173</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Insering data points into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">174</span>
<span class="linenos">175</span>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos">176</span>
<span class="linenos">177</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">178</span>            <span class="n">no_rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<span class="linenos">179</span>                <span class="s2">&quot;INSERT INTO KIOptiPackRaw (id, material_id, datum, laborant, rohwert_1_labormessung, &quot;</span>
<span class="linenos">180</span>                <span class="s2">&quot;rohwert_2_labormessung, rohwert_3_labormessung, aufbereiteter_wert) &quot;</span>
<span class="linenos">181</span>                <span class="s2">&quot;VALUES (</span><span class="si">%(id)s</span><span class="s2">,</span><span class="si">%(material_id)s</span><span class="s2">, </span><span class="si">%(datum)s</span><span class="s2">, </span><span class="si">%(laborant)s</span><span class="s2">, </span><span class="si">%(rohwert_1_labormessung)s</span><span class="s2">, &quot;</span>
<span class="linenos">182</span>                <span class="s2">&quot;</span><span class="si">%(rohwert_2_labormessung)s</span><span class="s2">, </span><span class="si">%(rohwert_3_labormessung)s</span><span class="s2">, </span><span class="si">%(aufbereiteter_wert)s</span><span class="s2">)&quot;</span><span class="p">,</span>
<span class="linenos">183</span>                <span class="n">data_points</span>
<span class="linenos">184</span>            <span class="p">)</span>
<span class="linenos">185</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos">186</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DB transaction result: </span><span class="si">{</span><span class="n">no_rows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">187</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted </span><span class="si">{</span><span class="n">no_rows</span><span class="si">}</span><span class="s2"> data points into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">188</span>
<span class="linenos">189</span>            <span class="c1"># feel free to include whatever information you want to return here.</span>
<span class="linenos">190</span>            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">191</span>                <span class="s2">&quot;acknowledged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="linenos">192</span>                <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="p">,</span>
<span class="linenos">193</span>                <span class="s2">&quot;no_rows&quot;</span><span class="p">:</span> <span class="n">no_rows</span><span class="p">,</span>
<span class="linenos">194</span>            <span class="p">}</span>
<span class="linenos">195</span>
<span class="linenos">196</span>            <span class="c1"># in principle one does not need to return information here.</span>
<span class="linenos">197</span>            <span class="c1"># However, some infos are return here, so that the requesting service can log the information.</span>
<span class="linenos">198</span>            <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">199</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">200</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while inserting data points into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">201</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">202</span>        <span class="k">finally</span><span class="p">:</span>
<span class="linenos">203</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">204</span>
<span class="linenos">205</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_GET_ALL_RAW_DATA_SUBJECT</span><span class="p">)</span>
<span class="linenos">206</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_all_raw_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">__</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">207</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">208</span><span class="sd">        Gets all raw data from the database.</span>
<span class="linenos">209</span>
<span class="linenos">210</span><span class="sd">        Parameters</span>
<span class="linenos">211</span><span class="sd">        ----------</span>
<span class="linenos">212</span><span class="sd">        _</span>
<span class="linenos">213</span><span class="sd">            The topic of the message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">214</span><span class="sd">        __</span>
<span class="linenos">215</span><span class="sd">            The message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">216</span>
<span class="linenos">217</span><span class="sd">        Returns</span>
<span class="linenos">218</span><span class="sd">        -------</span>
<span class="linenos">219</span><span class="sd">        Thing</span>
<span class="linenos">220</span><span class="sd">            A Thing containing the raw data from the database. If the operation was successful, the Thing will contain</span>
<span class="linenos">221</span><span class="sd">            the raw data. If the operation was not successful, the Thing will contain an error message.</span>
<span class="linenos">222</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">223</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received request to get all raw data from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">224</span>
<span class="linenos">225</span>        <span class="c1"># query all entries from the table KIOptiPackRaw</span>
<span class="linenos">226</span>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos">227</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">228</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM KIOptiPackRaw&quot;</span><span class="p">)</span>
<span class="linenos">229</span>            <span class="n">raw_data_entries</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="linenos">230</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">231</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while querying data from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">232</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">233</span>        <span class="k">finally</span><span class="p">:</span>
<span class="linenos">234</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">235</span>
<span class="linenos">236</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">raw_data_entries</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">237</span>
<span class="linenos">238</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_UPSERT_MANY_PROCESSED_DATAPOINTS_SUBJECT</span><span class="p">)</span>
<span class="linenos">239</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">db_save_upsert_processed_datapoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">240</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">241</span><span class="sd">        Saves or updates many processed data points in the database.</span>
<span class="linenos">242</span>
<span class="linenos">243</span><span class="sd">        Parameters</span>
<span class="linenos">244</span><span class="sd">        ----------</span>
<span class="linenos">245</span><span class="sd">        _</span>
<span class="linenos">246</span><span class="sd">            The topic of the message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">247</span><span class="sd">        msg</span>
<span class="linenos">248</span><span class="sd">            The message containing the processed data points to save or update.</span>
<span class="linenos">249</span>
<span class="linenos">250</span><span class="sd">        Returns</span>
<span class="linenos">251</span><span class="sd">        -------</span>
<span class="linenos">252</span><span class="sd">        Thing</span>
<span class="linenos">253</span><span class="sd">            A Thing containing the result of the operation. If the operation was successful, the Thing will contain</span>
<span class="linenos">254</span><span class="sd">            the number of rows inserted into the database. If the operation was not successful, the Thing will contain</span>
<span class="linenos">255</span><span class="sd">            an error message.</span>
<span class="linenos">256</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">257</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<span class="linenos">258</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Payload (the &#39;value&#39; field of the msg Thing) must be of type list, &quot;</span>
<span class="linenos">259</span>                      <span class="sa">f</span><span class="s2">&quot;but received: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">260</span>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Payload must be a list of processed data points&quot;</span><span class="p">)</span>
<span class="linenos">261</span>
<span class="linenos">262</span>        <span class="n">data_points</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">263</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span><span class="si">}</span><span class="s2"> processed data points to be inserted into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">264</span>
<span class="linenos">265</span>        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos">266</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">267</span>            <span class="n">res</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<span class="linenos">268</span>                <span class="s2">&quot;INSERT INTO KIOptiPackProcessed (&quot;</span>
<span class="linenos">269</span>                <span class="s2">&quot;id, aufbereiteter_wert, laborant_AN, laborant_HANS, laborant_SO, laborant_TK, &quot;</span>
<span class="linenos">270</span>                <span class="s2">&quot;material_id_00000000, material_id_11111111, &quot;</span>
<span class="linenos">271</span>                <span class="s2">&quot;material_id_22222222, material_id_33333333, &quot;</span>
<span class="linenos">272</span>                <span class="s2">&quot;rohwert_1_high, rohwert_1_low, rohwert_1_medium, rohwert_1_very_high, rohwert_1_very_low, &quot;</span>
<span class="linenos">273</span>                <span class="s2">&quot;rohwert_2_labormessung, rohwert_3_labormessung&quot;</span>
<span class="linenos">274</span>                <span class="s2">&quot;) VALUES (&quot;</span>
<span class="linenos">275</span>                <span class="s2">&quot;</span><span class="si">%(id)s</span><span class="s2">, </span><span class="si">%(aufbereiteter_wert)s</span><span class="s2">, </span><span class="si">%(laborant_AN)s</span><span class="s2">, </span><span class="si">%(laborant_HANS)s</span><span class="s2">, </span><span class="si">%(laborant_SO)s</span><span class="s2">, </span><span class="si">%(laborant_TK)s</span><span class="s2">, &quot;</span>
<span class="linenos">276</span>                <span class="s2">&quot;</span><span class="si">%(material_id_00000000)s</span><span class="s2">, </span><span class="si">%(material_id_11111111)s</span><span class="s2">, &quot;</span>
<span class="linenos">277</span>                <span class="s2">&quot;</span><span class="si">%(material_id_22222222)s</span><span class="s2">, </span><span class="si">%(material_id_33333333)s</span><span class="s2">, &quot;</span>
<span class="linenos">278</span>                <span class="s2">&quot;</span><span class="si">%(rohwert_1_high)s</span><span class="s2">, </span><span class="si">%(rohwert_1_low)s</span><span class="s2">, </span><span class="si">%(rohwert_1_medium)s</span><span class="s2">, </span><span class="si">%(rohwert_1_very_high)s</span><span class="s2">, </span><span class="si">%(rohwert_1_very_low)s</span><span class="s2">, &quot;</span>
<span class="linenos">279</span>                <span class="s2">&quot;</span><span class="si">%(rohwert_2_labormessung)s</span><span class="s2">, </span><span class="si">%(rohwert_3_labormessung)s</span><span class="s2">&quot;</span>
<span class="linenos">280</span>                <span class="s2">&quot;) ON DUPLICATE KEY UPDATE &quot;</span>
<span class="linenos">281</span>                <span class="s2">&quot;aufbereiteter_wert = VALUES(aufbereiteter_wert),&quot;</span>
<span class="linenos">282</span>                <span class="s2">&quot;laborant_AN = VALUES(laborant_AN),&quot;</span>
<span class="linenos">283</span>                <span class="s2">&quot;laborant_HANS = VALUES(laborant_HANS),&quot;</span>
<span class="linenos">284</span>                <span class="s2">&quot;laborant_SO = VALUES(laborant_SO),&quot;</span>
<span class="linenos">285</span>                <span class="s2">&quot;laborant_TK = VALUES(laborant_TK),&quot;</span>
<span class="linenos">286</span>                <span class="s2">&quot;material_id_00000000 = VALUES(material_id_00000000),&quot;</span>
<span class="linenos">287</span>                <span class="s2">&quot;material_id_11111111 = VALUES(material_id_11111111),&quot;</span>
<span class="linenos">288</span>                <span class="s2">&quot;material_id_22222222 = VALUES(material_id_22222222),&quot;</span>
<span class="linenos">289</span>                <span class="s2">&quot;material_id_33333333 = VALUES(material_id_33333333),&quot;</span>
<span class="linenos">290</span>                <span class="s2">&quot;rohwert_1_high = VALUES(rohwert_1_high),&quot;</span>
<span class="linenos">291</span>                <span class="s2">&quot;rohwert_1_low = VALUES(rohwert_1_low),&quot;</span>
<span class="linenos">292</span>                <span class="s2">&quot;rohwert_1_medium = VALUES(rohwert_1_medium),&quot;</span>
<span class="linenos">293</span>                <span class="s2">&quot;rohwert_1_very_high = VALUES(rohwert_1_very_high),&quot;</span>
<span class="linenos">294</span>                <span class="s2">&quot;rohwert_1_very_low = VALUES(rohwert_1_very_low),&quot;</span>
<span class="linenos">295</span>                <span class="s2">&quot;rohwert_2_labormessung = VALUES(rohwert_2_labormessung),&quot;</span>
<span class="linenos">296</span>                <span class="s2">&quot;rohwert_3_labormessung = VALUES(rohwert_3_labormessung)&quot;</span><span class="p">,</span>
<span class="linenos">297</span>                <span class="n">data_points</span>
<span class="linenos">298</span>            <span class="p">)</span>
<span class="linenos">299</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="linenos">300</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DB transaction result: </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">301</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserted </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2"> data points into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">302</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">303</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while inserting data points into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">304</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">305</span>
<span class="linenos">306</span>        <span class="c1"># feel free to include whatever information you want to return here.</span>
<span class="linenos">307</span>        <span class="n">db_specific_info</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">308</span>                <span class="s2">&quot;acknowledged&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="linenos">309</span>                <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;MariaDB&quot;</span>
<span class="linenos">310</span>        <span class="p">}</span>
<span class="linenos">311</span>
<span class="linenos">312</span>        <span class="c1"># in principle one does not need to return information here.</span>
<span class="linenos">313</span>        <span class="c1"># However, some infos are return here, so that the requesting service can log the information.</span>
<span class="linenos">314</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">db_specific_info</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">315</span>
<span class="linenos">316</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_GET_PROCESSED_DATA_COUNT_SUBJECT</span><span class="p">)</span>
<span class="linenos">317</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_processed_data_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">__</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">318</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">319</span><span class="sd">        Gets the number of processed data points from the database.</span>
<span class="linenos">320</span>
<span class="linenos">321</span><span class="sd">        Parameters</span>
<span class="linenos">322</span><span class="sd">        ----------</span>
<span class="linenos">323</span><span class="sd">        _</span>
<span class="linenos">324</span><span class="sd">            The topic of the message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">325</span><span class="sd">        __</span>
<span class="linenos">326</span><span class="sd">            The message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">327</span>
<span class="linenos">328</span><span class="sd">        Returns</span>
<span class="linenos">329</span><span class="sd">        -------</span>
<span class="linenos">330</span><span class="sd">        Thing</span>
<span class="linenos">331</span><span class="sd">            A Thing containing the number of processed data points from the database. If the operation was successful,</span>
<span class="linenos">332</span><span class="sd">            the Thing will contain the number of processed data points. If the operation was not successful, the Thing</span>
<span class="linenos">333</span><span class="sd">            will contain an error message.</span>
<span class="linenos">334</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">335</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received request to get the number of processed data points from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">336</span>
<span class="linenos">337</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">338</span>            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos">339</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) as count FROM KIOptiPackProcessed&quot;</span><span class="p">)</span>
<span class="linenos">340</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<span class="linenos">341</span>            <span class="n">count</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="linenos">342</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">343</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">344</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while counting processed data points in mariadb: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">345</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">346</span>
<span class="linenos">347</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">348</span>
<span class="linenos">349</span>    <span class="nd">@reply</span><span class="p">(</span><span class="n">DB_GET_PROCESSED_DATA_PAGE_SUBJECT</span><span class="p">)</span>
<span class="linenos">350</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_processed_data_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Thing</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Thing</span><span class="p">:</span>
<span class="linenos">351</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">352</span><span class="sd">        Gets a page of processed data points from the database.</span>
<span class="linenos">353</span>
<span class="linenos">354</span><span class="sd">        Parameters</span>
<span class="linenos">355</span><span class="sd">        ----------</span>
<span class="linenos">356</span><span class="sd">        _</span>
<span class="linenos">357</span><span class="sd">            The topic of the message. This is not used in the method, but is required by the `@reply` decorator.</span>
<span class="linenos">358</span><span class="sd">        msg</span>
<span class="linenos">359</span><span class="sd">            The message containing the parameters for the page. The message should contain the following fields:</span>
<span class="linenos">360</span><span class="sd">            - `page`: The page number to get.</span>
<span class="linenos">361</span><span class="sd">            - `page_size`: The number of items per page.</span>
<span class="linenos">362</span>
<span class="linenos">363</span><span class="sd">        Returns</span>
<span class="linenos">364</span><span class="sd">        -------</span>
<span class="linenos">365</span><span class="sd">        Thing</span>
<span class="linenos">366</span><span class="sd">            A Thing containing the page of processed data points from the database. If the operation was successful,</span>
<span class="linenos">367</span><span class="sd">            the Thing will contain the page of processed data points. If the operation was not successful, the Thing</span>
<span class="linenos">368</span><span class="sd">            will contain an error message.</span>
<span class="linenos">369</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">370</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received request to get a page of processed data points from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">371</span>        <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">372</span>            <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="linenos">373</span>            <span class="s2">&quot;page_size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="linenos">374</span>        <span class="p">}</span>
<span class="linenos">375</span>
<span class="linenos">376</span>        <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">value</span>
<span class="linenos">377</span>
<span class="linenos">378</span>        <span class="c1"># warning if unexpected parameters are present</span>
<span class="linenos">379</span>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="linenos">380</span>            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">default_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="linenos">381</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected parameter &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; in request. Ignoring it.&quot;</span><span class="p">)</span>
<span class="linenos">382</span>
<span class="linenos">383</span>        <span class="c1"># merge default and user parameters</span>
<span class="linenos">384</span>        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">default_params</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">}</span>
<span class="linenos">385</span>
<span class="linenos">386</span>        <span class="c1"># check &#39;page&#39; and &#39;page_size&#39; are in the params dict</span>
<span class="linenos">387</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">388</span>            <span class="k">if</span> <span class="s2">&quot;page&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s2">&quot;page_size&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
<span class="linenos">389</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;params must contain &#39;page&#39; and &#39;page_size&#39;&quot;</span><span class="p">)</span>
<span class="linenos">390</span>            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">391</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page must be &gt;= 0&quot;</span><span class="p">)</span>
<span class="linenos">392</span>            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">393</span>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;page_size must be &gt;= 0&quot;</span><span class="p">)</span>
<span class="linenos">394</span>
<span class="linenos">395</span>            <span class="n">page</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page&quot;</span><span class="p">]</span>
<span class="linenos">396</span>            <span class="n">page_size</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span>
<span class="linenos">397</span>            <span class="n">offset</span> <span class="o">=</span> <span class="n">page</span> <span class="o">*</span> <span class="n">page_size</span>
<span class="linenos">398</span>
<span class="linenos">399</span>            <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mariadb_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos">400</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM KIOptiPackProcessed LIMIT </span><span class="si">%s</span><span class="s2"> OFFSET </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">page_size</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
<span class="linenos">401</span>            <span class="n">page_documents</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="linenos">402</span>            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">403</span>
<span class="linenos">404</span>            <span class="c1"># drop id column</span>
<span class="linenos">405</span>            <span class="n">page_documents</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">page_documents</span><span class="p">]</span>
<span class="linenos">406</span>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">page_documents</span><span class="p">:</span>
<span class="linenos">407</span>                <span class="k">del</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
<span class="linenos">408</span>
<span class="linenos">409</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">410</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error while counting processed data points in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DB_NAME</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">411</span>            <span class="k">return</span> <span class="n">error_response_thing</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">412</span>
<span class="linenos">413</span>        <span class="k">return</span> <span class="n">ok_response_thing</span><span class="p">(</span><span class="n">payload</span><span class="o">=</span><span class="n">page_documents</span><span class="p">,</span> <span class="n">fiot_service</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">414</span>
<span class="linenos">415</span>
<span class="linenos">416</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">417</span>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="linenos">418</span>    <span class="n">DatabaseMariaService</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="influxdb-database-blueprint">
<h2>InfluxDB Database Blueprint<a class="headerlink" href="#influxdb-database-blueprint" title="Link to this heading">#</a></h2>
<p>lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">todo</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This blueprint has not been implemented yet.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="timescaledb-database-blueprint">
<h2>TimeScaleDB Database Blueprint<a class="headerlink" href="#timescaledb-database-blueprint" title="Link to this heading">#</a></h2>
<p>lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">todo</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This blueprint has not been implemented yet.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="blueprints-dataprocessing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Data Processing Blueprints</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="blueprints.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Blueprints</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Alexander Nasuta, Mats Gesenhues
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Database Blueprints</a><ul>
<li><a class="reference internal" href="#what-are-database-blueprints">What are Database Blueprints?</a></li>
<li><a class="reference internal" href="#our-database-blueprints">Our Database Blueprints</a></li>
<li><a class="reference internal" href="#mongodb-database-blueprint">MongoDB Database Blueprint</a></li>
<li><a class="reference internal" href="#mariadb-database-blueprint">MariaDB Database Blueprint</a></li>
<li><a class="reference internal" href="#influxdb-database-blueprint">InfluxDB Database Blueprint</a></li>
<li><a class="reference internal" href="#timescaledb-database-blueprint">TimeScaleDB Database Blueprint</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=4ea706d9"></script>
    </body>
</html>